package config;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

@WebServlet("/api/openapi.json")
public class SwaggerConfigServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        resp.setContentType("application/json;charset=UTF-8");
        resp.setCharacterEncoding("UTF-8");

        // CORS
        resp.setHeader("Access-Control-Allow-Origin", "*");
        resp.setHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
        resp.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization, ngrok-skip-browser-warning");

        // Build base URL động
        String scheme = req.getScheme();
        String serverName = req.getServerName();
        int port = req.getServerPort();
        String contextPath = req.getContextPath();

        String baseUrl = scheme + "://" + serverName
                + ((port == 80 || port == 443) ? "" : ":" + port)
                + contextPath;

        if (serverName.contains("ngrok-free.app")) {
            baseUrl = "https://" + serverName + contextPath;
        }

        try ( PrintWriter out = resp.getWriter()) {
            out.println("{");
            out.println("  \"openapi\": \"3.0.1\",");
            out.println("  \"info\": {");
            out.println("    \"title\": \"Battery Swap API\",");
            out.println("    \"description\": \"API cho hệ thống đổi pin xe điện — chia rõ theo vai trò Guest, Driver, Staff và Admin. (Bản inline, không dùng components/schemas)\",");
            out.println("    \"version\": \"1.0.0\"");
            out.println("  },");
            out.println("  \"tags\": [");
            out.println("    { \"name\": \"Guest\",  \"description\": \"API cho người dùng chưa đăng nhập.\" },");
            out.println("    { \"name\": \"Driver\", \"description\": \"API cho tài xế đã đăng nhập.\" },");
            out.println("    { \"name\": \"Staff\",  \"description\": \"API cho nhân viên trạm.\" },");
            out.println("    { \"name\": \"Admin\",  \"description\": \"API cho quản trị viên.\" }");
            out.println("  ],");
            out.println("  \"servers\": [");
            out.println("    { \"url\": \"" + baseUrl + "\", \"description\": \"Dynamic server\" }");
            out.println("  ],");

            // ====== components: chỉ khai securitySchemes (bearerAuth) ======
            out.println("  \"components\": {");
            out.println("    \"securitySchemes\": {");
            out.println("      \"bearerAuth\": {");
            out.println("        \"type\": \"http\",");
            out.println("        \"scheme\": \"bearer\",");
            out.println("        \"bearerFormat\": \"JWT\"");
            out.println("      }");
            out.println("    }");
            out.println("  },");

            out.println("  \"paths\": {");

            // ------------------------------
            // [GUEST] Login
            // ------------------------------
            out.println("    \"/api/login\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Đăng nhập hệ thống\",");
            out.println("        \"description\": \"Nhập email và mật khẩu để đăng nhập.\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"email\": { \"type\": \"string\" },");
            out.println("                  \"password\": { \"type\": \"string\" }");
            out.println("                },");
            out.println("                \"required\": [\"email\", \"password\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Đăng nhập thành công\" },");
            out.println("          \"401\": { \"description\": \"Sai email hoặc mật khẩu\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [GUEST] Register
            // ------------------------------
            out.println("    \"/api/register\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Đăng ký tài khoản mới\",");
            out.println("        \"description\": \"Tạo mới tài khoản người dùng (vai trò mặc định là Driver).\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"fullName\": { \"type\": \"string\" },");
            out.println("                  \"phone\":    { \"type\": \"string\" },");
            out.println("                  \"email\":    { \"type\": \"string\" },");
            out.println("                  \"password\": { \"type\": \"string\" }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Đăng ký thành công\" },");
            out.println("          \"400\": { \"description\": \"Dữ liệu không hợp lệ\" },");
            out.println("          \"409\": { \"description\": \"Email đã tồn tại\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [GUEST] Get Packages
            // ------------------------------
            out.println("    \"/api/getpackages\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Lấy danh sách gói pin\",");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Danh sách gói pin\" },");
            out.println("          \"204\": { \"description\": \"Không có gói pin nào\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [GUEST] Get Stations (dropdown)
            // ------------------------------
            out.println("    \"/api/getstations\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Lấy danh sách trạm đổi pin (dùng cho dropdown)\",");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách trạm\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"status\": { \"type\": \"string\", \"example\": \"success\" },");
            out.println("                    \"data\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"station_ID\": { \"type\": \"integer\", \"example\": 3 },");
            out.println("                          \"name\":       { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                          \"address\":    { \"type\": \"string\",  \"example\": \"12 Nguyen Trai, Q1\" },");
            out.println("                          \"lat\":        { \"type\": \"number\",  \"format\": \"double\", \"example\": 10.7769 },");
            out.println("                          \"lng\":        { \"type\": \"number\",  \"format\": \"double\", \"example\": 106.7009 }");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"200b\": { \"description\": \"{status:'fail', message:'No station found'}\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [ADMIN] Guest battery report
            // ------------------------------
            out.println("    \"/api/getStationBatteryReportGuest\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Báo cáo tổng hợp pin tại các trạm (guest API)\",");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"stationId\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"integer\"}, \"description\":\"Lọc theo 1 trạm nếu cung cấp\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Danh sách báo cáo trạm\" },");
            out.println("          \"400\": { \"description\": \"stationId không hợp lệ\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [DRIVER] Link Vehicle (multipart)
            // ------------------------------
            out.println("    \"/api/linkVehicleController\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Liên kết xe với tài khoản\",");
            out.println("        \"description\": \"Upload ảnh cà vẹt xe để nhận dạng và lưu vào DB.\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"multipart/form-data\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"carDoc\": { \"type\": \"string\", \"format\": \"binary\" },");
            out.println("                  \"model\": { \"type\": \"string\" },");
            out.println("                  \"batteryType\": { \"type\": \"string\" }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Xe đã được thêm vào DB\" },");
            out.println("          \"400\": { \"description\": \"Thiếu dữ liệu hoặc file không hợp lệ\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý hoặc OCR thất bại\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [DRIVER] Get Profile (JWT)
            // ------------------------------
            out.println("    \"/api/secure/getProfile\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Lấy thông tin hồ sơ tài xế (JWT)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Thông tin người dùng và gói pin hiện tại.\" },");
            out.println("          \"401\": { \"description\": \"Thiếu hoặc token không hợp lệ\" },");
            out.println("          \"404\": { \"description\": \"Không tìm thấy user\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ server\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [DRIVER] Update Profile (JWT)
            // ------------------------------
            out.println("    \"/api/secure/profile/update\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Cập nhật hồ sơ (JWT)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"fullName\": {\"type\":\"string\"},");
            out.println("                  \"phone\": {\"type\":\"string\"},");
            out.println("                  \"avatarUrl\": {\"type\":\"string\"}");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Cập nhật thành công\" },");
            out.println("          \"400\": { \"description\": \"Body không hợp lệ\" },");
            out.println("          \"401\": { \"description\": \"Thiếu/invalid JWT\" },");
            out.println("          \"500\": { \"description\": \"Lỗi server\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [DRIVER] Upload Avatar (multipart + JWT)
            // ------------------------------
            out.println("    \"/api/secure/profile/upload-avatar\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Upload avatar (multipart + JWT)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"multipart/form-data\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"avatar\": { \"type\":\"string\", \"format\":\"binary\" }");
            out.println("                },");
            out.println("                \"required\": [\"avatar\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Upload & cập nhật thành công\" },");
            out.println("          \"400\": { \"description\": \"Thiếu file hoặc sai định dạng\" },");
            out.println("          \"401\": { \"description\": \"Thiếu/invalid JWT\" },");
            out.println("          \"500\": { \"description\": \"Lỗi server\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] Create Booking (JWT)
            // =====================================================================
            out.println("    \"/api/secure/booking\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Đặt lịch đổi pin trong ngày (JWT)\",");
            out.println("        \"description\": \"- Chỉ cho phép đặt trong HÔM NAY (Asia/Ho_Chi_Minh).\\n- Không được chọn thời gian quá khứ.\\n- Tối đa 3 booking đang hiệu lực/user.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"stationName\": { \"type\": \"string\", \"example\": \"Station A\" },");
            out.println("                  \"vehicleId\":   { \"type\": \"integer\", \"example\": 101 },");
            out.println("                  \"bookingTime\": { \"type\": \"string\",  \"nullable\": true, \"example\": \"2025-11-02T14:30\" },");
            out.println("                  \"date\":        { \"type\": \"string\",  \"nullable\": true, \"example\": \"02/11/2025\" },");
            out.println("                  \"time\":        { \"type\": \"string\",  \"nullable\": true, \"example\": \"02:30 CH\" }");
            out.println("                },");
            out.println("                \"required\": [\"stationName\", \"vehicleId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Tạo booking thành công\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"bookingId\":         { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                    \"userId\":            { \"type\": \"integer\", \"example\": 17 },");
            out.println("                    \"vehicleId\":         { \"type\": \"integer\", \"example\": 101 },");
            out.println("                    \"stationId\":         { \"type\": \"integer\", \"example\": 3 },");
            out.println("                    \"chargingStationId\": { \"type\": \"integer\", \"example\": 7 },");
            out.println("                    \"slotId\":            { \"type\": \"integer\", \"example\": 142 },");
            out.println("                    \"batteryType\":       { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                    \"status\":            { \"type\": \"string\",  \"example\": \"Reserved\" },");
            out.println("                    \"bookingTime\":       { \"type\": \"string\",  \"example\": \"2025-11-02 14:30:00.000\" },");
            out.println("                    \"expiredTime\":       { \"type\": \"string\",  \"example\": \"2025-11-02 15:30:00.000\" },");
            out.println("                    \"qrCode\":            { \"type\": \"string\",  \"nullable\": true, \"example\": \"data:image/png;base64,iVBORw0K...\" }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Thiếu/không hợp lệ tham số hoặc không phải hôm nay/giờ quá khứ\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized (thiếu JWT)\" },");
            out.println("          \"403\": { \"description\": \"Vehicle không thuộc user\" },");
            out.println("          \"404\": { \"description\": \"Station không tồn tại / Không có pin phù hợp\" },");
            out.println("          \"409\": { \"description\": \"Đã đạt giới hạn 3 booking đang hiệu lực\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] Tạo giao dịch VNPay mua gói  ->  GET /api/payment
            // =====================================================================
            out.println("    \"/api/payment\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Khởi tạo thanh toán VNPay cho gói pin\",");
            out.println("        \"description\": \"Sinh URL thanh toán VNPay (HTTP 302). Hệ thống lấy giá gói từ DB và đóng gói tham số theo chuẩn VNPay.\",");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"userId\",    \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"integer\"}, \"description\": \"ID người dùng\" },");
            out.println("          { \"name\": \"orderType\", \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\", \"enum\":[\"buyPackage\"]}, \"description\": \"Loại đơn (mặc định buyPackage)\" },");
            out.println("          { \"name\": \"packageId\", \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"integer\"}, \"description\": \"ID gói pin đang ACTIVE\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"302\": { \"description\": \"Redirect tới trang thanh toán VNPay\" },");
            out.println("          \"400\": { \"description\": \"Thiếu/sai tham số hoặc gói không ACTIVE\" },");
            out.println("          \"500\": { \"description\": \"Lỗi nội bộ khi tạo URL thanh toán\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] VNPay ReturnUrl mua gói  ->  GET /api/buyPackage
            // =====================================================================
            out.println("    \"/api/buyPackage\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] VNPay ReturnUrl sau khi thanh toán gói pin\",");
            out.println("        \"description\": \"VNPay gọi về với các tham số vnp_*. Hệ thống kiểm tra chữ ký, mã phản hồi, ghi nhận thanh toán và cấp/cập nhật gói 30 ngày.\",");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"vnp_TxnRef\",       \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\"} },");
            out.println("          { \"name\": \"vnp_ResponseCode\", \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\"} },");
            out.println("          { \"name\": \"vnp_SecureHash\",   \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\"} },");
            out.println("          { \"name\": \"vnp_OrderInfo\",    \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\"}, \"description\": \"Chuỗi chứa userId, packageId, orderType\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Xử lý xong: cập nhật/khởi tạo DriverPackage & ghi giao dịch\",");
            out.println("            \"content\": {");
            out.println("              \"text/plain\": {");
            out.println("                \"schema\": { \"type\": \"string\", \"example\": \"✅ Thanh toán thành công! Gói 2 cho User 17\" }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Tham số thiếu/không hợp lệ\" },");
            out.println("          \"401\": { \"description\": \"Chữ ký VNPay không hợp lệ\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [STAFF] Checkin + VNPay ReturnUrl
            // ------------------------------
            out.println("    \"/api/checkin\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Check-in & Swap pin theo Booking ID\",");
            out.println("        \"description\": \"Nếu cần thanh toán: trả paymentUrl (VNPay).\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/x-www-form-urlencoded\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"bookingId\": { \"type\": \"integer\", \"example\": 1234 }");
            out.println("                },");
            out.println("                \"required\": [\"bookingId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"OK (paymentUrl hoặc chi tiết swap)\" },");
            out.println("          \"400\": { \"description\": \"Thiếu/sai tham số\" },");
            out.println("          \"409\": { \"description\": \"Booking không hợp lệ\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      },");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[VNPay] ReturnUrl sau khi thanh toán swap\",");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"vnp_TxnRef\",       \"in\": \"query\", \"required\": true, \"schema\": {\"type\":\"string\"} },");
            out.println("          { \"name\": \"vnp_ResponseCode\", \"in\": \"query\", \"required\": true, \"schema\": {\"type\":\"string\"} },");
            out.println("          { \"name\": \"vnp_SecureHash\",   \"in\": \"query\", \"required\": true, \"schema\": {\"type\":\"string\"} }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Hoàn tất swap sau thanh toán.\" },");
            out.println("          \"400\": { \"description\": \"Tham số hoặc chữ ký không hợp lệ\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [STAFF] Staff Booking (GET/POST) (JWT)
            // ------------------------------
            out.println("    \"/api/secure/staffBooking\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Nhập email (và tùy chọn station) để lấy danh sách xe liên kết (bước chọn)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"email\",   \"in\": \"query\", \"required\": true,  \"schema\": {\"type\":\"string\"},  \"description\":\"Email khách (đã verify, unique)\" },");
            out.println("          { \"name\": \"station\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\"},  \"description\":\"Tên trạm (để BE check stationId sớm)\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"OK\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"user\": {");
            out.println("                      \"type\": \"object\",");
            out.println("                      \"properties\": {");
            out.println("                        \"id\":        { \"type\": \"integer\", \"example\": 17 },");
            out.println("                        \"fullName\":  { \"type\": \"string\",  \"example\": \"Nguyen Van A\" },");
            out.println("                        \"email\":     { \"type\": \"string\",  \"example\": \"khach@example.com\" }");
            out.println("                      }");
            out.println("                    },");
            out.println("                    \"vehicles\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"vehicleId\":    { \"type\": \"integer\", \"example\": 101 },");
            out.println("                          \"modelId\":      { \"type\": \"integer\", \"example\": 5 },");
            out.println("                          \"modelName\":    { \"type\": \"string\",  \"example\": \"Gogoro S2 ABS\" },");
            out.println("                          \"brand\":        { \"type\": \"string\",  \"example\": \"Gogoro\" },");
            out.println("                          \"batteryType\":  { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                          \"vin\":          { \"type\": \"string\",  \"example\": \"LL12345...\" },");
            out.println("                          \"licensePlate\": { \"type\": \"string\",  \"example\": \"59A1-123.45\" }");
            out.println("                        }");
            out.println("                      }");
            out.println("                    },");
            out.println("                    \"stationId\":    { \"type\": \"integer\", \"nullable\": true, \"example\": 3 },");
            out.println("                    \"stationError\": { \"type\": \"string\",  \"nullable\": true, \"example\": \"Station not found\" }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Missing 'email'\" },");
            out.println("          \"403\": { \"description\": \"Forbidden: staff only\" },");
            out.println("          \"404\": { \"description\": \"User not found by email\" },");
            out.println("          \"500\": { \"description\": \"Internal error\" }");
            out.println("        }");
            out.println("      },");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Tạo booking thay khách (BE tự khóa thời gian now + 1h)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"email\":       { \"type\": \"string\",  \"example\": \"khach@example.com\" },");
            out.println("                  \"stationName\": { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                  \"vehicleId\":   { \"type\": \"integer\", \"example\": 101 }");
            out.println("                },");
            out.println("                \"required\": [\"email\", \"stationName\", \"vehicleId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Đặt lịch thành công\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"bookingId\":         { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                    \"userId\":            { \"type\": \"integer\", \"example\": 17 },");
            out.println("                    \"vehicleId\":         { \"type\": \"integer\", \"example\": 101 },");
            out.println("                    \"stationId\":         { \"type\": \"integer\", \"example\": 3 },");
            out.println("                    \"chargingStationId\": { \"type\": \"integer\", \"example\": 7 },");
            out.println("                    \"slotId\":            { \"type\": \"integer\", \"example\": 142 },");
            out.println("                    \"batteryType\":       { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                    \"status\":            { \"type\": \"string\",  \"example\": \"Reserved\" },");
            out.println("                    \"bookingTime\":       { \"type\": \"string\",  \"example\": \"2025-10-23 08:12:34.123\" },");
            out.println("                    \"expiredTime\":       { \"type\": \"string\",  \"example\": \"2025-10-23 09:12:34.123\" },");
            out.println("                    \"qrCode\":            { \"type\": \"string\",  \"nullable\": true, \"example\": \"data:image/png;base64,iVBORw0K...\" }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Thiếu/sai tham số\" },");
            out.println("          \"403\": { \"description\": \"Forbidden: staff only\" },");
            out.println("          \"404\": { \"description\": \"User not found / No suitable battery\" },");
            out.println("          \"500\": { \"description\": \"Internal server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [STAFF] View Battery Slot Status (JWT)
            // ------------------------------
            out.println("    \"/api/secure/viewBatterySlotStatus\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Xem tình trạng các slot pin tại trạm được gán (JWT)\",");
            out.println("        \"description\": \"Hiển thị 20 slot của trạm: serial pin, SOC/SOH, trạng thái.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách các slot pin tại trạm\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"array\",");
            out.println("                  \"items\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"slotId\": { \"type\": \"integer\", \"example\": 142, \"description\": \"ID của slot\" },");
            out.println("                      \"slotNumber\": { \"type\": \"integer\", \"example\": 7, \"description\": \"Số thứ tự slot (1-20)\" },");
            out.println("                      \"stationId\": { \"type\": \"integer\", \"example\": 3, \"description\": \"ID trạm\" },");
            out.println("                      \"chargingStationId\": { \"type\": \"integer\", \"example\": 7, \"description\": \"ID trạm sạc\" },");
            out.println("                      \"batteryId\": { \"type\": \"integer\", \"nullable\": true, \"example\": 245, \"description\": \"ID pin (null nếu slot trống)\" },");
            out.println("                      \"batteryType\": { \"type\": \"string\", \"nullable\": true, \"example\": \"LFP\", \"description\": \"Loại pin: Lithium-Ion hoặc LFP\" },");
            out.println("                      \"batterySerial\": { \"type\": \"string\", \"nullable\": true, \"example\": \"BAT-LFP-00245\", \"description\": \"Mã serial pin\" },");
            out.println("                      \"soc\": { \"type\": \"number\", \"format\": \"double\", \"nullable\": true, \"example\": 95.5, \"description\": \"State of Charge (%)\" },");
            out.println("                      \"soh\": { \"type\": \"number\", \"format\": \"double\", \"nullable\": true, \"example\": 98.2, \"description\": \"State of Health (%)\" },");
            out.println("                      \"status\": { \"type\": \"string\", \"example\": \"Available\" },");
            out.println("                      \"isCharging\": { \"type\": \"boolean\", \"example\": false },");
            out.println("                      \"lastUpdated\": { \"type\": \"string\", \"format\": \"date-time\", \"nullable\": true, \"example\": \"2025-10-23T14:30:00\" }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Staff chưa được gán trạm\" },");
            out.println("          \"401\": { \"description\": \"Thiếu hoặc token không hợp lệ\" },");
            out.println("          \"403\": { \"description\": \"Chỉ Staff mới có quyền truy cập\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ server\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [ADMIN] Analytics Monthly (JWT)
            // ------------------------------
            out.println("    \"/api/secure/analyticsRevenue\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Doanh thu & lượt đổi pin theo trạm (tháng hiện tại)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"OK - Danh sách {stationId, stationName, year, month, swapCount, swapRevenue}\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"403\": { \"description\": \"Access denied: Admin only\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // ------------------------------
            // [ADMIN] Assistant Chat (JWT)
            // ------------------------------
            out.println("    \"/api/secure/assistant/chat\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] AI Chat (điều phối pin)\",");
            out.println("        \"description\": \"Cho phép admin đặt câu hỏi. Backend sẽ gọi AI và các tool nội bộ để trả lời.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"message\": { \"type\": \"string\", \"example\": \"Gợi ý điều phối Li-ion hôm nay?\" }");
            out.println("                },");
            out.println("                \"required\": [\"message\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"OK\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\": { \"type\": \"boolean\" },");
            out.println("                    \"answer\":  { \"type\": \"string\" }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"403\": { \"description\": \"Admin only\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] My Swap History (JWT)
            // =====================================================================
            out.println("    \"/api/secure/my-swap-history\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Lịch sử đổi pin (PaymentTransaction Package_ID = NULL)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"from\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\", \"format\":\"date\"}, \"description\":\"Lọc từ ngày (yyyy-MM-dd)\" },");
            out.println("          { \"name\": \"to\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\", \"format\":\"date\"}, \"description\":\"Lọc đến ngày (yyyy-MM-dd)\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách giao dịch đổi pin\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"userId\": { \"type\": \"integer\" },");
            out.println("                    \"filters\": {");
            out.println("                      \"type\": \"object\",");
            out.println("                      \"properties\": { \"from\": {\"type\":\"string\"}, \"to\": {\"type\":\"string\"} }");
            out.println("                    },");
            out.println("                    \"items\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"id\": {\"type\":\"integer\"},");
            out.println("                          \"userId\": {\"type\":\"integer\"},");
            out.println("                          \"stationId\": {\"type\":\"integer\", \"nullable\": true},");
            out.println("                          \"amount\": {\"type\":\"number\", \"format\":\"double\", \"nullable\": true},");
            out.println("                          \"paymentMethod\": {\"type\":\"string\"},");
            out.println("                          \"description\": {\"type\":\"string\"},");
            out.println("                          \"transactionTime\": {\"type\":\"string\"}");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] My Package History (JWT)
            // =====================================================================
            out.println("    \"/api/secure/my-package-history\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Lịch sử mua/thuê gói pin (PaymentTransaction Package_ID != NULL)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"from\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\", \"format\":\"date\"}, \"description\":\"Lọc từ ngày (yyyy-MM-dd)\" },");
            out.println("          { \"name\": \"to\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\", \"format\":\"date\"}, \"description\":\"Lọc đến ngày (yyyy-MM-dd)\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách giao dịch mua/thuê gói pin\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"userId\": { \"type\": \"integer\" },");
            out.println("                    \"filters\": {");
            out.println("                      \"type\": \"object\",");
            out.println("                      \"properties\": { \"from\": {\"type\":\"string\"}, \"to\": {\"type\":\"string\"} }");
            out.println("                    },");
            out.println("                    \"items\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"id\": {\"type\":\"integer\"},");
            out.println("                          \"userId\": {\"type\":\"integer\"},");
            out.println("                          \"packageId\": {\"type\":\"integer\"},");
            out.println("                          \"amount\": {\"type\":\"number\", \"format\":\"double\", \"nullable\": true},");
            out.println("                          \"paymentMethod\": {\"type\":\"string\"},");
            out.println("                          \"description\": {\"type\":\"string\"},");
            out.println("                          \"transactionTime\": {\"type\":\"string\"}");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            // =====================================================================
            // [DRIVER] Comments (JWT) — theo CommentController bạn gửi
            // =====================================================================
            out.println("    \"/api/secure/comments\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Xem nhận xét (JWT)\",");
            out.println("        \"description\": \"Nếu có ?swapId: trả list comment của swap đó. Nếu không có swapId: chỉ Admin/Staff mới xem trang tổng.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"swapId\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"integer\"}, \"description\": \"ID giao dịch swap\" },");
            out.println("          { \"name\": \"page\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"integer\", \"default\": 1} },");
            out.println("          { \"name\": \"size\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"integer\", \"default\": 20} }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách nhận xét\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"array\",");
            out.println("                  \"items\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"id\": { \"type\": \"integer\", \"example\": 12 },");
            out.println("                      \"userId\": { \"type\": \"integer\", \"example\": 17 },");
            out.println("                      \"swapId\": { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                      \"content\": { \"type\": \"string\", \"example\": \"Pin tốt, nhân viên nhiệt tình\" },");
            out.println("                      \"createdAt\": { \"type\": \"string\", \"example\": \"2025-10-28T09:12:45\" }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"UNAUTHORIZED\" },");
            out.println("          \"403\": { \"description\": \"FORBIDDEN\" },");
            out.println("          \"400\": { \"description\": \"BAD_REQUEST\" },");
            out.println("          \"500\": { \"description\": \"DB_ERROR/Server error\" }");
            out.println("        }");
            out.println("      },");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Gửi nhận xét cho swap đã hoàn tất (JWT)\",");
            out.println("        \"description\": \"Chỉ Driver là chủ swap và trạng thái swap = 'Completed' mới được comment. Mỗi swap chỉ một nhận xét.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"swapId\": { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                  \"content\": { \"type\": \"string\", \"example\": \"Dịch vụ tốt, tốc độ nhanh\" }");
            out.println("                },");
            out.println("                \"required\": [\"swapId\", \"content\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Tạo nhận xét thành công\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"status\": { \"type\": \"string\", \"example\": \"success\" },");
            out.println("                    \"commentId\": { \"type\": \"integer\", \"example\": 501 }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"UNAUTHORIZED\" },");
            out.println("          \"403\": { \"description\": \"FORBIDDEN (không phải chủ swap / swap chưa Completed / đã comment)\" },");
            out.println("          \"409\": { \"description\": \"DUPLICATE\" },");
            out.println("          \"400\": { \"description\": \"VALIDATION_ERROR | BAD_JSON\" },");
            out.println("          \"500\": { \"description\": \"DB_ERROR | Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //----------------------
            // Driver Xem Booking
            //----------------------
            out.println("    ,\"/api/secure/my-bookings\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Driver\"],");
            out.println("        \"summary\": \"[Driver] Lịch sử booking của tôi (JWT)\",");
            out.println("        \"description\": \"Trả về danh sách booking của tài xế, hỗ trợ lọc theo trạng thái và/hoặc khoảng thời gian.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          {");
            out.println("            \"name\": \"status\",");
            out.println("            \"in\": \"query\",");
            out.println("            \"required\": false,");
            out.println("            \"schema\": { \"type\": \"string\", \"enum\": [\"Reserved\",\"Expired\",\"Completed\"] },");
            out.println("            \"description\": \"Lọc theo trạng thái (không phân biệt hoa/thường; giá trị khác sẽ bị bỏ qua)\"");
            out.println("          },");
            out.println("          {");
            out.println("            \"name\": \"start\",");
            out.println("            \"in\": \"query\",");
            out.println("            \"required\": false,");
            out.println("            \"schema\": { \"type\": \"string\", \"example\": \"2025-10-01\" },");
            out.println("            \"description\": \"Ngày/giờ bắt đầu (YYYY-MM-DD hoặc YYYY-MM-DD HH:mm:ss)\"");
            out.println("          },");
            out.println("          {");
            out.println("            \"name\": \"end\",");
            out.println("            \"in\": \"query\",");
            out.println("            \"required\": false,");
            out.println("            \"schema\": { \"type\": \"string\", \"example\": \"2025-10-31 23:59:59\" },");
            out.println("            \"description\": \"Ngày/giờ kết thúc (YYYY-MM-DD hoặc YYYY-MM-DD HH:mm:ss)\"");
            out.println("          }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách booking của user\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"userId\": { \"type\": \"integer\", \"example\": 17 },");
            out.println("                    \"filters\": {");
            out.println("                      \"type\": \"object\",");
            out.println("                      \"properties\": {");
            out.println("                        \"start\":  { \"type\": \"string\", \"nullable\": true, \"example\": \"2025-10-01\" },");
            out.println("                        \"end\":    { \"type\": \"string\", \"nullable\": true, \"example\": \"2025-10-31\" },");
            out.println("                        \"status\": { \"type\": \"string\", \"nullable\": true, \"example\": \"Completed\" }");
            out.println("                      }");
            out.println("                    },");
            out.println("                    \"count\": { \"type\": \"integer\", \"example\": 3 },");
            out.println("                    \"items\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"bookingId\":           { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                          \"stationName\":         { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                          \"chargingStationName\": { \"type\": \"string\",  \"nullable\": true, \"example\": \"Charger Bay 1\" },");
            out.println("                          \"vehicleId\":           { \"type\": \"integer\", \"example\": 101 },");
            out.println("                          \"modelName\":           { \"type\": \"string\",  \"example\": \"Gogoro S2 ABS\" },");
            out.println("                          \"licensePlate\":        { \"type\": \"string\",  \"example\": \"59A1-123.45\" },");
            out.println("                          \"batteryRequest\":      { \"type\": \"string\",  \"nullable\": true, \"example\": \"LFP\" },");
            out.println("                          \"status\":              { \"type\": \"string\",  \"example\": \"Reserved\" },");
            out.println("                          \"statusVi\":            { \"type\": \"string\",  \"example\": \"Đặt trước\" },");
            out.println("                          \"bookingDate\":         { \"type\": \"string\",  \"nullable\": true, \"example\": \"2025-11-02\" },");
            out.println("                          \"bookingTime\":         { \"type\": \"string\",  \"nullable\": true, \"example\": \"14:30:00\" },");
            out.println("                          \"expiredDate\":         { \"type\": \"string\",  \"nullable\": true, \"example\": \"2025-11-02\" },");
            out.println("                          \"expiredTime\":         { \"type\": \"string\",  \"nullable\": true, \"example\": \"15:30:00\" },");
            out.println("                          \"slotId\":              { \"type\": \"integer\", \"nullable\": true, \"example\": 142 }");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"Unauthorized (thiếu JWT)\" },");
            out.println("          \"403\": { \"description\": \"Forbidden: Driver only\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ / Database error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //---------------------
            // Staff: Gắn pin vào slot pin
            //---------------------
            out.println("    ,\"/api/secure/assignBatteryToSlot\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Gán pin vào slot (auto map SoH → Condition)\",");
            out.println("        \"description\": \"Đọc SoH của pin, map sang Condition (ví dụ: <75 = Damage, ≥75 = Good) rồi gán pin vào slot.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"slotId\": { \"type\": \"integer\", \"example\": 142 },");
            out.println("                  \"batteryId\": { \"type\": \"integer\", \"example\": 245 }");
            out.println("                },");
            out.println("                \"required\": [\"slotId\", \"batteryId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Kết quả gán pin\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\": { \"type\": \"boolean\", \"example\": true }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Payload không hợp lệ\" },");
            out.println("          \"401\": { \"description\": \"Thiếu/invalid JWT\" },");
            out.println("          \"500\": { \"description\": \"Lỗi xử lý nội bộ\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //-----------------
            // Staff: Gỡ pin ra khỏi slot
            //-----------------
            out.println("    ,\"/api/secure/removeBatteryFromSlot\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Gỡ pin khỏi slot hiện tại\",");
            out.println("        \"description\": \"Tách pin khỏi slot và trả về assignSlotId mới (nếu có logic chuyển).\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/x-www-form-urlencoded\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"slotId\": { \"type\": \"integer\", \"example\": 142 }");
            out.println("                },");
            out.println("                \"required\": [\"slotId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Gỡ thành công\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"ok\": { \"type\": \"boolean\", \"example\": true },");
            out.println("                    \"message\": { \"type\": \"string\", \"example\": \"Đã gỡ pin khỏi slot.\" },");
            out.println("                    \"assignSlotId\": { \"type\": \"integer\", \"nullable\": true, \"example\": 153 }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"409\": { \"description\": \"Không thể gỡ pin: slot không hợp lệ hoặc đã thay đổi\" },");
            out.println("          \"400\": { \"description\": \"Tham số không hợp lệ\" },");
            out.println("          \"401\": { \"description\": \"Thiếu/invalid JWT\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //-----------------------
            // Staff: Xem danh sách pin trong kho
            //-----------------------
            out.println("    ,\"/api/secure/available-batteries\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Lấy danh sách pin sẵn sàng (chưa gán slot)\",");
            out.println("        \"description\": \"Trả về danh sách tất cả các pin có trạng thái khả dụng, chưa gán vào bất kỳ slot nào.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách pin khả dụng\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"array\",");
            out.println("                  \"items\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"battery_ID\":   { \"type\": \"integer\", \"example\": 245 },");
            out.println("                      \"serialNumber\": { \"type\": \"string\",  \"example\": \"BAT-LFP-00245\" },");
            out.println("                      \"soH\":          { \"type\": \"number\",  \"format\": \"double\", \"example\": 98.4 },");
            out.println("                      \"resistance\":   { \"type\": \"number\",  \"format\": \"double\", \"example\": 0.035 },");
            out.println("                      \"typeId\":       { \"type\": \"integer\", \"example\": 2 },");
            out.println("                      \"batteryType\":  { \"type\": \"string\",  \"example\": \"LFP\" }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            //--------------------------
            //Staff: Xem thông tin chi tiết pin trong slot
            //--------------------------
            out.println("    \"/api/secure/getBatteryInfo\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Lấy thông tin chi tiết pin trong slot (JWT)\",");
            out.println("        \"description\": \"Dành cho Staff hoặc Manager. Truyền slotId qua query param để lấy thông tin pin và slot.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"slotId\", \"in\": \"query\", \"required\": true, \"schema\": {\"type\": \"integer\"}, \"description\": \"ID slot cần xem thông tin pin\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Thông tin chi tiết của pin trong slot\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\":      { \"type\": \"boolean\", \"example\": true },");
            out.println("                    \"slotId\":       { \"type\": \"integer\", \"example\": 142 },");
            out.println("                    \"slotCode\":     { \"type\": \"string\",  \"example\": \"CS1-S07\" },");
            out.println("                    \"stationName\":  { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                    \"serialNumber\": { \"type\": \"string\",  \"example\": \"BAT-LFP-00245\" },");
            out.println("                    \"resistance\":   { \"type\": \"number\",  \"format\": \"double\", \"example\": 0.035 },");
            out.println("                    \"soH\":          { \"type\": \"number\",  \"format\": \"double\", \"example\": 98.2 },");
            out.println("                    \"typeId\":       { \"type\": \"integer\", \"example\": 2 },");
            out.println("                    \"condition\":    { \"type\": \"string\",  \"example\": \"Good\" },");
            out.println("                    \"lastUpdate\":   { \"type\": \"string\",  \"example\": \"2025-11-02T14:30:00\" }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Thiếu hoặc sai định dạng slotId\" },");
            out.println("          \"403\": { \"description\": \"Access denied: chỉ Staff/Manager\" },");
            out.println("          \"404\": { \"description\": \"Slot hoặc battery không tồn tại\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //--------------------------------
            //Manager: Xem nhận xét từ Driver gửi về cho manager từng trạm
            //--------------------------------
            out.println("    ,\"/api/secure/viewComments\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Xem danh sách nhận xét theo trạm của Manager (JWT)\",");
            out.println("        \"description\": \"⚠️ Manager only. Trả về các nhận xét (comments) thuộc các trạm do Manager hiện tại phụ trách.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách nhận xét theo phạm vi quản lý\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"count\": { \"type\": \"integer\", \"example\": 5 },");
            out.println("                    \"items\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"id\":         { \"type\": \"integer\", \"example\": 101 },");
            out.println("                          \"userId\":     { \"type\": \"integer\", \"example\": 17 },");
            out.println("                          \"swapId\":     { \"type\": \"integer\", \"example\": 8892 },");
            out.println("                          \"content\":    { \"type\": \"string\",  \"example\": \"Dịch vụ tốt\" },");
            out.println("                          \"createdAt\":  { \"type\": \"string\",  \"example\": \"2025-11-02T10:15:00\" },");
            out.println("                          \"stationId\":  { \"type\": \"integer\", \"example\": 3 },");
            out.println("                          \"stationName\":{ \"type\": \"string\",  \"example\": \"Station A\" }");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"403\": { \"description\": \"FORBIDDEN: Only Manager can view comments\" },");
            out.println("          \"401\": { \"description\": \"UNAUTHORIZED\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");

            //--------------------------------
            //Manager: Gửi request yêu cầu điều phối pin về cho admin
            //--------------------------------
            out.println("    \"/api/secure/dispatchRequest\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Tạo yêu cầu điều phối pin từ trạm (JWT)\",");
            out.println("        \"description\": \"⚠️ Manager only. Manager của trạm gửi yêu cầu theo loại pin và số lượng Good/Average/Bad. Station_ID được xác định theo user đăng nhập (không nhận từ FE).\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/x-www-form-urlencoded\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"batteryName\": { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                  \"qtyGood\":    { \"type\": \"integer\", \"example\": 10 },");
            out.println("                  \"qtyAverage\": { \"type\": \"integer\", \"example\": 5 },");
            out.println("                  \"qtyBad\":     { \"type\": \"integer\", \"example\": 2 }");
            out.println("                },");
            out.println("                \"required\": [\"batteryName\", \"qtyGood\", \"qtyAverage\", \"qtyBad\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Tạo yêu cầu thành công\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\":  { \"type\": \"boolean\", \"example\": true },");
            out.println("                    \"requestId\":{ \"type\": \"integer\", \"example\": 512 }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"400\": { \"description\": \"Missing required fields | Quantity must be integer | Quantity cannot be negative | At least one quantity must be > 0 | Battery type not found\" },");
            out.println("          \"403\": { \"description\": \"Access denied (Manager only) | Manager has no assigned station\" },");
            out.println("          \"401\": { \"description\": \"Missing user identity\" },");
            out.println("          \"500\": { \"description\": \"Insert failed | Cannot resolve Station_ID | Unexpected/Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            //-----------------------
            //Manager: Xem request yêu cầu điều phối pin tình trạng
            //-----------------------
            out.println("    ,\"/api/secure/dispatchPending\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Staff\"],");
            out.println("        \"summary\": \"[Staff] Danh sách yêu cầu điều phối liên quan tới trạm của Manager (JWT)\",");
            out.println("        \"description\": \"⚠️ Manager only. Trả về mọi yêu cầu dispatch mà trạm của Manager hiện tại là người yêu cầu (requester) hoặc người phản hồi (responder).\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách các request liên quan\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"array\",");
            out.println("                  \"items\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"requestId\":           { \"type\": \"integer\", \"example\": 1205 },");
            out.println("                      \"stationRequestId\":    { \"type\": \"integer\", \"example\": 3 },");
            out.println("                      \"stationRequestName\":  { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                      \"stationRespondId\":    { \"type\": \"integer\", \"nullable\": true, \"example\": 7 },");
            out.println("                      \"stationRespondName\":  { \"type\": \"string\",  \"nullable\": true, \"example\": \"Station B\" },");
            out.println("                      \"batteryTypeId\":       { \"type\": \"integer\", \"example\": 2 },");
            out.println("                      \"batteryName\":         { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                      \"qtyGood\":             { \"type\": \"integer\", \"example\": 10 },");
            out.println("                      \"qtyAverage\":          { \"type\": \"integer\", \"example\": 5 },");
            out.println("                      \"qtyBad\":              { \"type\": \"integer\", \"example\": 2 },");
            out.println("                      \"requestTime\":         { \"type\": \"string\",  \"example\": \"2025-11-02\" },");
            out.println("                      \"respondTime\":         { \"type\": \"string\",  \"nullable\": true, \"example\": \"2025-11-03\" },");
            out.println("                      \"status\":              { \"type\": \"string\",  \"example\": \"Pending\" },");
            out.println("                      \"isMyStationRequest\":  { \"type\": \"boolean\", \"example\": true },");
            out.println("                      \"isMyStationRespond\":  { \"type\": \"boolean\", \"example\": false }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"403\": { \"description\": \"Access denied (Manager only)\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            // --- ADMIN: lấy danh sách dispatch còn Pending (toàn hệ thống) ---
            out.println("    ,\"/api/secure/admindispatchPending\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Liệt kê các yêu cầu điều phối đang Pending (toàn hệ thống)\",");
            out.println("        \"description\": \"⚠️ Admin only. Trả về các yêu cầu dispatch có trạng thái Pending.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách request Pending\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"array\",");
            out.println("                  \"items\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"requestId\":          { \"type\": \"integer\", \"example\": 1205 },");
            out.println("                      \"stationRequestName\": { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                      \"batteryName\":        { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                      \"qtyGood\":            { \"type\": \"integer\", \"example\": 10 },");
            out.println("                      \"qtyAverage\":         { \"type\": \"integer\", \"example\": 5 },");
            out.println("                      \"qtyBad\":             { \"type\": \"integer\", \"example\": 2 },");
            out.println("                      \"status\":             { \"type\": \"string\",  \"example\": \"Pending\" },");
            out.println("                      \"requestTime\":        { \"type\": \"string\",  \"example\": \"2025-11-02\" }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"403\": { \"description\": \"Access denied (Admin only)\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: analytics swap theo tháng hiện tại (toàn bộ trạm) ---
            out.println("    ,\"/api/secure/analyticsSwap\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Thống kê lượt đổi pin/doanh thu theo trạm trong tháng hiện tại\",");
            out.println("        \"description\": \"⚠️ Admin only. Trả về danh sách số liệu từng trạm ở tháng hiện tại.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"OK\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\": { \"type\": \"boolean\", \"example\": true },");
            out.println("                    \"stations\": {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"additionalProperties\": true,");
            out.println("                        \"example\": {");
            out.println("                          \"stationId\": 3,");
            out.println("                          \"stationName\": \"Station A\",");
            out.println("                          \"year\": 2025,");
            out.println("                          \"month\": 11,");
            out.println("                          \"swapCount\": 128,");
            out.println("                          \"swapRevenue\": 25600000");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"403\": { \"description\": \"Access denied: Admin only\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: duyệt/cancel dispatch request (đặt trạng thái PREPARING hoặc Cancelled) ---
            out.println("    ,\"/api/secure/dispatchApprove\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Approve/Cancel yêu cầu điều phối\",");
            out.println("        \"description\": \"⚠️ Admin only. Approve sẽ đặt trạng thái \\\"Preparing\\\" và gán Station Respond theo tên trạm. Cancel sẽ đặt \\\"Cancelled\\\".\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/x-www-form-urlencoded\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"requestId\":          { \"type\": \"integer\", \"example\": 1205 },");
            out.println("                  \"action\":             { \"type\": \"string\",  \"enum\": [\"approve\",\"cancel\"], \"example\": \"approve\" },");
            out.println("                  \"stationRespondName\": { \"type\": \"string\",  \"nullable\": true, \"example\": \"Station B\", \"description\": \"Bắt buộc khi action=approve\" }");
            out.println("                },");
            out.println("                \"required\": [\"requestId\", \"action\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"OK (set PREPARING hoặc Cancelled)\" },");
            out.println("          \"400\": { \"description\": \"Thiếu/sai tham số\" },");
            out.println("          \"404\": { \"description\": \"Request/Station không tồn tại\" },");
            out.println("          \"403\": { \"description\": \"Access denied (Admin only)\" },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            // --- ADMIN: Analytics khung giờ cao điểm theo trạm (tháng/khoảng ngày) ---
            out.println("    ,\"/api/secure/analytics/peak-hours/stations\": {");
            out.println("      \"get\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Khung giờ cao điểm ổn định nhất theo từng trạm\",");
            out.println("        \"description\": \"Cho phép Admin và Staff (theo BE). Tham số lọc tùy chọn: startDate, endDate, minRate (0..1, default 0.60).\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"parameters\": [");
            out.println("          { \"name\": \"startDate\", \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\",\"format\":\"date\"}, \"description\":\"yyyy-MM-dd\" },");
            out.println("          { \"name\": \"endDate\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"string\",\"format\":\"date\"}, \"description\":\"yyyy-MM-dd\" },");
            out.println("          { \"name\": \"minRate\",   \"in\": \"query\", \"required\": false, \"schema\": {\"type\":\"number\",\"minimum\":0,\"maximum\":1,\"example\":0.6}, \"description\":\"Ngưỡng tần suất (0..1), mặc định 0.60\" }");
            out.println("        ],");
            out.println("        \"responses\": {");
            out.println("          \"200\": {");
            out.println("            \"description\": \"Danh sách khung giờ tiêu biểu mỗi trạm\",");
            out.println("            \"content\": {");
            out.println("              \"application/json\": {");
            out.println("                \"schema\": {");
            out.println("                  \"type\": \"object\",");
            out.println("                  \"properties\": {");
            out.println("                    \"success\":   { \"type\": \"boolean\", \"example\": true },");
            out.println("                    \"minRate\":   { \"type\": \"number\",  \"example\": 0.6 },");
            out.println("                    \"totalDays\": { \"type\": \"integer\", \"nullable\": true, \"example\": 31 },");
            out.println("                    \"stations\":  {");
            out.println("                      \"type\": \"array\",");
            out.println("                      \"items\": {");
            out.println("                        \"type\": \"object\",");
            out.println("                        \"properties\": {");
            out.println("                          \"stationId\":       { \"type\": \"integer\", \"example\": 3 },");
            out.println("                          \"stationName\":     { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                          \"timeSlot\":        { \"type\": \"string\",  \"example\": \"14:00-15:00\" },");
            out.println("                          \"hourOfDay\":       { \"type\": \"integer\", \"example\": 14 },");
            out.println("                          \"activeDays\":      { \"type\": \"integer\", \"example\": 22 },");
            out.println("                          \"totalDays\":       { \"type\": \"integer\", \"example\": 31 },");
            out.println("                          \"hitRate\":         { \"type\": \"number\",  \"example\": 0.71 },");
            out.println("                          \"totalSwaps\":      { \"type\": \"integer\", \"example\": 180 },");
            out.println("                          \"avgPerActiveDay\": { \"type\": \"number\",  \"example\": 8.2 }");
            out.println("                        }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          },");
            out.println("          \"401\": { \"description\": \"Unauthorized\" },");
            out.println("          \"403\": { \"description\": \"Access denied\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: Thêm gói (Add Package) ---
            out.println("    ,\"/api/secure/addPackage\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Tạo gói pin mới\",");
            out.println("        \"description\": \"Admin only. Body JSON ánh xạ DTO Package (name, description, price, requiredSoH, minSoH, maxSoH, status)\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"name\":         { \"type\": \"string\",  \"example\": \"Premium\" },");
            out.println("                  \"description\":  { \"type\": \"string\",  \"example\": \"SOH >= 95%\" },");
            out.println("                  \"price\":        { \"type\": \"number\",  \"example\": 399000 },");
            out.println("                  \"requiredSoH\":  { \"type\": \"number\",  \"example\": 95 },");
            out.println("                  \"minSoH\":       { \"type\": \"integer\", \"example\": 90 },");
            out.println("                  \"maxSoH\":       { \"type\": \"integer\", \"example\": 100 },");
            out.println("                  \"status\":       { \"type\": \"string\",  \"example\": \"active\" }");
            out.println("                },");
            out.println("                \"required\": [\"name\",\"price\",\"requiredSoH\",\"minSoH\",\"maxSoH\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Tạo gói thành công\" },");
            out.println("          \"400\": { \"description\": \"Thiếu/không hợp lệ dữ liệu\" },");
            out.println("          \"403\": { \"description\": \"Access denied: Admin only\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: Xóa gói (soft delete) - DELETE & fallback POST ---
            out.println("    ,\"/api/secure/package\": {");
            out.println("      \"delete\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Xóa gói (soft-delete: status='inactive')\",");
            out.println("        \"description\": \"Admin only. Truyền JSON body với packageId.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"packageId\": { \"type\": \"integer\", \"example\": 12 }");
            out.println("                },");
            out.println("                \"required\": [\"packageId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Đã chuyển status='inactive'\" },");
            out.println("          \"400\": { \"description\": \"Invalid body\" },");
            out.println("          \"403\": { \"description\": \"Access denied: Admin only\" },");
            out.println("          \"404\": { \"description\": \"Package not found\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: Fallback POST delete (đúng theo annotation /api/secure/packageDelete) ---
            out.println("    ,\"/api/secure/packageDelete\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Xóa gói (fallback POST)\",");
            out.println("        \"description\": \"Admin only. Body JSON { packageId }. Kết quả giống DELETE /api/secure/package.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"packageId\": { \"type\": \"integer\", \"example\": 12 }");
            out.println("                },");
            out.println("                \"required\": [\"packageId\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Đã chuyển status='inactive'\" },");
            out.println("          \"400\": { \"description\": \"Invalid body\" },");
            out.println("          \"403\": { \"description\": \"Access denied: Admin only\" },");
            out.println("          \"404\": { \"description\": \"Package not found\" },");
            out.println("          \"500\": { \"description\": \"Server error\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

// --- ADMIN: Cập nhật Station & danh sách Charging_Station (upsert + sync) ---
            out.println("    ,\"/api/secure/updateStation\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Admin\"],");
            out.println("        \"summary\": \"[Admin] Cập nhật Station và đồng bộ Charging_Station\",");
            out.println("        \"description\": \"Admin only. Body JSON gồm { station, chargingStations[], syncMode }. syncMode='keep-missing' (default) hoặc 'delete-missing'.\",");
            out.println("        \"security\": [ { \"bearerAuth\": [] } ],");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"station\": {");
            out.println("                    \"type\": \"object\",");
            out.println("                    \"properties\": {");
            out.println("                      \"stationId\": { \"type\": \"integer\", \"example\": 3 },");
            out.println("                      \"name\":      { \"type\": \"string\",  \"example\": \"Station A\" },");
            out.println("                      \"address\":   { \"type\": \"string\",  \"example\": \"12 Nguyen Trai, Q1\" }");
            out.println("                    },");
            out.println("                    \"required\": [\"stationId\", \"name\"]");
            out.println("                  },");
            out.println("                  \"chargingStations\": {");
            out.println("                    \"type\": \"array\",");
            out.println("                    \"items\": {");
            out.println("                      \"type\": \"object\",");
            out.println("                      \"properties\": {");
            out.println("                        \"chargingStationId\": { \"type\": \"integer\", \"example\": 7 },");
            out.println("                        \"name\":             { \"type\": \"string\",  \"example\": \"Bay 1\" },");
            out.println("                        \"slotCapacity\":     { \"type\": \"integer\", \"example\": 20 },");
            out.println("                        \"slotType\":         { \"type\": \"string\",  \"example\": \"LFP\" },");
            out.println("                        \"powerRating\":      { \"type\": \"string\",  \"example\": \"7.5\" }");
            out.println("                      }");
            out.println("                    }");
            out.println("                  },");
            out.println("                  \"syncMode\": { \"type\": \"string\", \"enum\": [\"keep-missing\",\"delete-missing\"], \"example\": \"keep-missing\" }");
            out.println("                }");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Cập nhật thành công (upsert CS, tùy chọn xóa mục thiếu)\" },");
            out.println("          \"400\": { \"description\": \"Invalid JSON / thiếu trường bắt buộc\" },");
            out.println("          \"403\": { \"description\": \"FORBIDDEN: Admin only\" },");
            out.println("          \"404\": { \"description\": \"Station not found\" },");
            out.println("          \"500\": { \"description\": \"INTERNAL_ERROR\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            // ===== Guest APIs =====
            out.println("    ,\"/api/forgot-password\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Gửi email đặt lại mật khẩu (JWT + OTP)\",");
            out.println("        \"description\": \"Sinh token JWT (10 phút) và OTP (5 phút, 1 lần dùng) rồi gửi email cho người dùng.\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": { \"email\": { \"type\": \"string\", \"example\": \"user@example.com\" } },");
            out.println("                \"required\": [\"email\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Đã gửi OTP và link reset về email\" },");
            out.println("          \"400\": { \"description\": \"Email trống/không hợp lệ\" },");
            out.println("          \"404\": { \"description\": \"Email không tồn tại\" },");
            out.println("          \"500\": { \"description\": \"Không gửi được email / lỗi server\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");
            out.println("    \"/api/register/send-otp\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Gửi OTP đăng ký\",");
            out.println("        \"description\": \"Tiếp nhận thông tin đăng ký (fullName/phone/email/password), sinh OTP và gửi email.\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"fullName\": { \"type\": \"string\", \"example\": \"Nguyen Van A\" },");
            out.println("                  \"phone\":    { \"type\": \"string\", \"example\": \"0901234567\" },");
            out.println("                  \"email\":    { \"type\": \"string\", \"example\": \"newuser@example.com\" },");
            out.println("                  \"password\": { \"type\": \"string\", \"example\": \"P@ssw0rd!\" }");
            out.println("                },");
            out.println("                \"required\": [\"email\", \"password\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"OTP đã được gửi tới email\" },");
            out.println("          \"409\": { \"description\": \"Email đã tồn tại\" },");
            out.println("          \"500\": { \"description\": \"Lỗi server / DB\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");
            out.println("    \"/api/register/resend-otp\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Gửi lại OTP đăng ký\",");
            out.println("        \"description\": \"Cho phép gửi lại OTP cho phiên đăng ký đang pending (có hạn chế tần suất).\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": { \"email\": { \"type\": \"string\", \"example\": \"newuser@example.com\" } },");
            out.println("                \"required\": [\"email\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"OTP đã được gửi lại\" },");
            out.println("          \"400\": { \"description\": \"Không có phiên đăng ký hoặc input không hợp lệ\" },");
            out.println("          \"429\": { \"description\": \"Quá số lần gửi lại trong thời gian ngắn\" },");
            out.println("          \"502\": { \"description\": \"Gửi email thất bại\" }");
            out.println("        }");
            out.println("      }");
            out.println("    },");
            out.println("    \"/api/register/verify-otp\": {");
            out.println("      \"post\": {");
            out.println("        \"tags\": [\"Guest\"],");
            out.println("        \"summary\": \"[Guest] Xác thực OTP & tạo tài khoản\",");
            out.println("        \"description\": \"Xác minh OTP còn hạn, tạo tài khoản Driver mặc định và trả JWT đăng nhập.\",");
            out.println("        \"requestBody\": {");
            out.println("          \"required\": true,");
            out.println("          \"content\": {");
            out.println("            \"application/json\": {");
            out.println("              \"schema\": {");
            out.println("                \"type\": \"object\",");
            out.println("                \"properties\": {");
            out.println("                  \"email\": { \"type\": \"string\", \"example\": \"newuser@example.com\" },");
            out.println("                  \"otp\": { \"type\": \"string\", \"example\": \"123456\" }");
            out.println("                },");
            out.println("                \"required\": [\"email\", \"otp\"]");
            out.println("              }");
            out.println("            }");
            out.println("          }");
            out.println("        },");
            out.println("        \"responses\": {");
            out.println("          \"200\": { \"description\": \"Tạo tài khoản thành công, trả token\" },");
            out.println("          \"400\": { \"description\": \"OTP sai hoặc hết hạn\" },");
            out.println("          \"409\": { \"description\": \"Email đã tồn tại\" },");
            out.println("          \"429\": { \"description\": \"Quá nhiều lần thử sai\" }");
            out.println("        }");
            out.println("      }");
            out.println("    }");

            // ===== END paths =====
            out.println("  }");
            out.println("}");
        }
    }
}
