package config;

import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

import java.io.IOException;
import java.io.PrintWriter;

@WebServlet("/api/openapi.json")
public class SwaggerConfigServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {

        resp.setContentType("application/json;charset=UTF-8");

        // =========================
        // ===== API: /api/login ===
        // =========================
        String loginPath
                = "\"/api/login\":{"
                + "\"post\":{"
                + "\"summary\":\"Login\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/LoginRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"OK\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/LoginResponse\"}"
                + "}"
                + "}"
                + "},"
                + "\"401\":{\"description\":\"Unauthorized\"}"
                + "}"
                + "}"
                + "}";

        // ================================
        // ===== API: /api/register =======
        // ================================
        String registerPath
                = "\"/api/register\":{"
                + "\"post\":{"
                + "\"summary\":\"Register new user (no OTP)\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/RegisterRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"Registered successfully (returns token & user)\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/LoginResponse\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"Validation error\"},"
                + "\"409\":{\"description\":\"Email already exists\"}"
                + "}"
                + "}"
                + "}";

        // ==========================================
        // ===== API: /api/register/send-otp ========
        // ==========================================
        String sendOtpPath
                = "\"/api/register/send-otp\":{"
                + "\"post\":{"
                + "\"summary\":\"Register step 1 - Send OTP to email\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/RegisterRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"OTP sent\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/StatusMessage\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"Validation error or invalid input\"},"
                + "\"409\":{\"description\":\"Email already exists\"},"
                + "\"502\":{\"description\":\"Failed to send OTP email\"}"
                + "}"
                + "}"
                + "}";

        // ============================================
        // ===== API: /api/register/verify-otp ========
        // ============================================
        String verifyOtpPath
                = "\"/api/register/verify-otp\":{"
                + "\"post\":{"
                + "\"summary\":\"Register step 2 - Verify OTP & create account\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/VerifyOtpRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"OTP valid, user created, return token & user\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/LoginResponse\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"OTP invalid or expired\"},"
                + "\"409\":{\"description\":\"Email already exists (race condition)\"}"
                + "}"
                + "}"
                + "}";

        // =============================================
        // ===== API: /api/register/resend-otp =========
        // =============================================
        String resendOtpPath
                = "\"/api/register/resend-otp\":{"
                + "\"post\":{"
                + "\"summary\":\"Resend OTP for pending registration\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/ResendOtpRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"OTP resent\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/StatusMessage\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"No pending registration for this email\"},"
                + "\"429\":{\"description\":\"Too many resends\"},"
                + "\"502\":{\"description\":\"Failed to send OTP email\"}"
                + "}"
                + "}"
                + "}";

        // ===== API: /api/reset-password START =====
        String resetPasswordPath
                = "\"/api/reset-password\":{"
                + "\"post\":{"
                + "\"summary\":\"Reset password b·∫±ng OTP\"," 
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/ResetPasswordRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng\"," 
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/StatusMessage\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"Thi·∫øu d·ªØ li·ªáu ho·∫∑c m·∫≠t kh·∫©u y·∫øu\"},"
                + "\"401\":{\"description\":\"OTP kh√¥ng h·ª£p l·ªá\"},"
                + "\"500\":{\"description\":\"L·ªói server khi c·∫≠p nh·∫≠t m·∫≠t kh·∫©u\"}"
                + "}"
                + "}"
                + "}";

        // ===== API: /api/forgot-password START =====
        String forgotPasswordPath
                = "\"/api/forgot-password\":{"
                + "\"post\":{"
                + "\"summary\":\"G·ª≠i OTP v√† token ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u qua email\","
                + "\"requestBody\":{"
                + "\"required\":true,"
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/ForgotPasswordRequest\"}"
                + "}"
                + "}"
                + "},"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"ƒê√£ g·ª≠i OTP v√† link ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{\"$ref\":\"#/components/schemas/StatusMessage\"}"
                + "}"
                + "}"
                + "},"
                + "\"400\":{\"description\":\"Email thi·∫øu ho·∫∑c kh√¥ng h·ª£p l·ªá\"},"
                + "\"404\":{\"description\":\"Email kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng\"},"
                + "\"500\":{\"description\":\"L·ªói server khi g·ª≠i email\"}"
                + "}"
                + "}"
                + "}";

        // ===== API: /api/events (GET ALL EVENTS, JWT) =====
        String eventsPath
                = "\"/api/events\":{"
                + "\"get\":{"
                + "\"summary\":\"Get all events (JWT, roles: STUDENT/ORGANIZER/STAFF/ADMIN)\","
                + "\"security\":[{\"bearerAuth\":[]}],"
                + "\"responses\":{"
                + "\"200\":{"
                + "\"description\":\"List of events\","
                + "\"content\":{"
                + "\"application/json\":{"
                + "\"schema\":{"
                + "\"type\":\"array\","
                + "\"items\":{\"$ref\":\"#/components/schemas/EventList\"}"
                + "}"
                + "}"
                + "}"
                + "},"
                + "\"401\":{\"description\":\"Unauthorized\"},"
                + "\"403\":{\"description\":\"Forbidden\"}"
                + "}"
                + "}"
                + "}";

        String eventDetailPath
                = "\"/api/events/detail\":{"
                + "\"get\":{"
                + "\"summary\":\"Get event detail (JWT required)\","
                + "\"description\":\"Return event detail including venue, speaker and ticket categories\","
                + "\"security\":[{\"bearerAuth\":[]}],"
                + "\"parameters\":["
                + "    {"
                + "      \"name\":\"id\","
                + "      \"in\":\"query\","
                + "      \"required\":true,"
                + "      \"schema\":{\"type\":\"integer\"},"
                + "      \"description\":\"Event ID\""
                + "    }"
                + "],"
                + "\"responses\":{"
                + "  \"200\":{"
                + "    \"description\":\"Event detail\","
                + "    \"content\":{"
                + "      \"application/json\":{"
                + "        \"schema\":{\"$ref\":\"#/components/schemas/EventDetail\"}"
                + "      }"
                + "    }"
                + "  },"
                + "  \"401\":{\"description\":\"Unauthorized\"},"
                + "  \"403\":{\"description\":\"Forbidden\"},"
                + "  \"404\":{\"description\":\"Event not found\"}"
                + "}"
                + "}"
                + "}";
        
          String seatsPath
                = "\"/api/seats\":{"
                + "\"get\":{"
                + "\"summary\":\"Get seats by area & optional seatType (JWT)\","
                + "\"description\":\"Tr·∫£ v·ªÅ danh s√°ch gh·∫ø theo khu v·ª±c (Venue_Area), c√≥ th·ªÉ l·ªçc theo lo·∫°i gh·∫ø (VIP/STANDARD/...)\","
                + "\"security\":[{\"bearerAuth\":[]}],"
                + "\"parameters\":["
                + "  {"
                + "    \"name\":\"areaId\","
                + "    \"in\":\"query\","
                + "    \"required\":true,"
                + "    \"schema\":{\"type\":\"integer\"},"
                + "    \"description\":\"ID khu v·ª±c (area_id trong Venue_Area) ch·ª©a s∆° ƒë·ªì gh·∫ø\""
                + "  },"
                + "  {"
                + "    \"name\":\"seatType\","
                + "    \"in\":\"query\","
                + "    \"required\":false,"
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"description\":\"Lo·∫°i gh·∫ø (VIP / STANDARD / ...)\""
                + "  }"
                + "],"
                + "\"responses\":{"
                + "  \"200\":{"
                + "    \"description\":\"Danh s√°ch gh·∫ø theo area (v√† lo·∫°i gh·∫ø n·∫øu c√≥)\","
                + "    \"content\":{"
                + "      \"application/json\":{"
                + "        \"schema\":{\"$ref\":\"#/components/schemas/SeatResponse\"}"
                + "      }"
                + "    }"
                + "  },"
                + "  \"400\":{"
                + "    \"description\":\"Thi·∫øu ho·∫∑c sai areaId\""
                + "  },"
                + "  \"401\":{"
                + "    \"description\":\"Unauthorized (thi·∫øu/ sai JWT)\""
                + "  },"
                + "  \"500\":{"
                + "    \"description\":\"L·ªói server khi load danh s√°ch gh·∫ø\""
                + "  }"
                + "}"
                + "}"
                + "}";

        String paymentTicketPath
                = "\"/api/payment-ticket\":{"
                + "\"get\":{"
                + "\"summary\":\"T·∫°o URL thanh to√°n VNPay cho v√© s·ª± ki·ªán\","
                + "\"description\":\"Validate user/event/categoryTicket/seat v√† redirect sang VNPay Sandbox\","
                + "\"security\":[{\"bearerAuth\":[]}],"
                + "\"parameters\":["
                + "  {"
                + "    \"name\":\"userId\","
                + "    \"in\":\"query\","
                + "    \"required\":true,"
                + "    \"schema\":{\"type\":\"integer\"},"
                + "    \"description\":\"ID ng∆∞·ªùi d√πng\""
                + "  },"
                + "  {"
                + "    \"name\":\"eventId\","
                + "    \"in\":\"query\","
                + "    \"required\":true,"
                + "    \"schema\":{\"type\":\"integer\"},"
                + "    \"description\":\"ID s·ª± ki·ªán\""
                + "  },"
                + "  {"
                + "    \"name\":\"categoryTicketId\","
                + "    \"in\":\"query\","
                + "    \"required\":true,"
                + "    \"schema\":{\"type\":\"integer\"},"
                + "    \"description\":\"ID lo·∫°i v√© (VIP / STANDARD)\""
                + "  },"
                + "  {"
                + "    \"name\":\"seatId\","
                + "    \"in\":\"query\","
                + "    \"required\":true,"
                + "    \"schema\":{\"type\":\"integer\"},"
                + "    \"description\":\"ID gh·∫ø ng·ªìi\""
                + "  }"
                + "],"
                + "\"responses\":{"
                + "  \"302\":{"
                + "    \"description\":\"Redirect sang VNPay ƒë·ªÉ thanh to√°n\""
                + "  },"
                + "  \"400\":{"
                + "    \"description\":\"Tham s·ªë kh√¥ng h·ª£p l·ªá ho·∫∑c gh·∫ø/lo·∫°i v√©/s·ª± ki·ªán kh√¥ng h·ª£p l·ªá\""
                + "  },"
                + "  \"500\":{"
                + "    \"description\":\"L·ªói server khi build URL VNPay\""
                + "  }"
                + "}"
                + "}"
                + "}";

        String buyTicketPath
                = "\"/api/buyTicket\":{"
                + "\"get\":{"
                + "\"summary\":\"VNPay return URL - x√°c nh·∫≠n thanh to√°n v√† t·∫°o v√©\","
                + "\"description\":\"VNPay redirect v·ªÅ URL n√†y sau khi thanh to√°n. H·ªá th·ªëng s·∫Ω verify ch·ªØ k√Ω, ki·ªÉm tra m√£ ph·∫£n h·ªìi, t·∫°o Bill & Ticket.\","
                + "\"parameters\":["
                + "  {"
                + "    \"name\":\"vnp_Amount\","
                + "    \"in\":\"query\","
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"required\":false,"
                + "    \"description\":\"S·ªë ti·ªÅn VNPay tr·∫£ v·ªÅ (ƒë∆°n v·ªã x100)\""
                + "  },"
                + "  {"
                + "    \"name\":\"vnp_ResponseCode\","
                + "    \"in\":\"query\","
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"required\":false,"
                + "    \"description\":\"M√£ k·∫øt qu·∫£ giao d·ªãch (00 = th√†nh c√¥ng)\""
                + "  },"
                + "  {"
                + "    \"name\":\"vnp_OrderInfo\","
                + "    \"in\":\"query\","
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"required\":false,"
                + "    \"description\":\"Th√¥ng tin order ƒë√£ encode (userId, eventId, categoryTicketId, seatId, orderType)\""
                + "  },"
                + "  {"
                + "    \"name\":\"vnp_TxnRef\","
                + "    \"in\":\"query\","
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"required\":false,"
                + "    \"description\":\"M√£ tham chi·∫øu giao d·ªãch\""
                + "  },"
                + "  {"
                + "    \"name\":\"vnp_SecureHash\","
                + "    \"in\":\"query\","
                + "    \"schema\":{\"type\":\"string\"},"
                + "    \"required\":false,"
                + "    \"description\":\"Ch·ªØ k√Ω b·∫£o m·∫≠t HMAC SHA512\""
                + "  }"
                + "],"
                + "\"responses\":{"
                + "  \"200\":{"
                + "    \"description\":\"K·∫øt qu·∫£ x·ª≠ l√Ω thanh to√°n (text)\","
                + "    \"content\":{"
                + "      \"text/plain\":{"
                + "        \"schema\":{\"type\":\"string\"}"
                + "      }"
                + "    }"
                + "  }"
                + "}"
                + "}"
                + "}";

        // ================================
        // ========== GH√âP JSON ===========
        // ================================
        String json
                = "{"
                + "\"openapi\":\"3.0.1\","
                + "\"info\":{\"title\":\"FPT Event Management API\",\"version\":\"1.0.0\"},"
                + "\"servers\":[{\"url\":\"http://localhost:8080/FPTEventManagement\"}],"
                + "\"paths\":{"
                + loginPath + ","
                + registerPath + ","
                + sendOtpPath + ","
                + verifyOtpPath + ","
                + resendOtpPath + ","
                + resetPasswordPath + ","
                + forgotPasswordPath + ","
                + eventsPath + ","
                + seatsPath + ","           
                + eventDetailPath + ","
                + paymentTicketPath + "," // ‚úÖ th√™m d√≤ng n√†y
                + buyTicketPath // ‚úÖ v√† d√≤ng n√†y (kh√¥ng c√≥ d·∫•u ph·∫©y ph√≠a sau)
                + "},"
                + "\"components\":{"
                // ===== SECURITY SCHEMES (BEARER JWT) =====
                + "\"securitySchemes\":{"
                + "\"bearerAuth\":{"
                + "\"type\":\"http\","
                + "\"scheme\":\"bearer\","
                + "\"bearerFormat\":\"JWT\""
                + "}"
                + "},"
                // ====== SCHEMAS ======
                + "\"schemas\":{"
                // LoginRequest
                + "\"LoginRequest\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"email\":{\"type\":\"string\"},"
                + "\"password\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"email\",\"password\"]"
                + "},"
                // RegisterRequest
                + "\"RegisterRequest\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"fullName\":{\"type\":\"string\"},"
                + "\"phone\":{\"type\":\"string\"},"
                + "\"email\":{\"type\":\"string\"},"
                + "\"password\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"fullName\",\"phone\",\"email\",\"password\"]"
                + "},"
                // VerifyOtpRequest
                + "\"VerifyOtpRequest\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"email\":{\"type\":\"string\"},"
                + "\"otp\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"email\",\"otp\"]"
                + "},"
                // ResendOtpRequest
                + "\"ResendOtpRequest\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"email\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"email\"]"
                + "},"
                // ResetPasswordRequest (no token, use email + OTP)
                + "\"ResetPasswordRequest\":{"
                + "\"type\":\"object\"," 
                + "\"properties\":{"
                + "\"otp\":{\"type\":\"string\",\"pattern\":\"^[0-9]{6}$\"},"
                + "\"newPassword\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"otp\",\"newPassword\"]"
                + "},"
                // User
                + "\"User\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"id\":{\"type\":\"integer\"},"
                + "\"fullName\":{\"type\":\"string\"},"
                + "\"email\":{\"type\":\"string\"},"
                + "\"phone\":{\"type\":\"string\"},"
                + "\"role\":{\"type\":\"string\"},"
                + "\"status\":{\"type\":\"string\"}"
                + "}"
                + "},"
                // LoginResponse
                + "\"LoginResponse\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"status\":{\"type\":\"string\"},"
                + "\"message\":{\"type\":\"string\"},"
                + "\"token\":{\"type\":\"string\"},"
                + "\"user\":{\"$ref\":\"#/components/schemas/User\"}"
                + "}"
                + "},"
                // ForgotPasswordRequest
                + "\"ForgotPasswordRequest\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"email\":{\"type\":\"string\"}"
                + "},"
                + "\"required\":[\"email\"]"
                + "},"
                // StatusMessage
                + "\"StatusMessage\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"status\":{\"type\":\"string\"},"
                + "\"message\":{\"type\":\"string\"}"
                + "}"
                + "},"
                // EventList (d√πng cho /api/events)
                + "\"EventList\":{"
                + "\"type\":\"object\","
                + "\"properties\":{"
                + "\"eventId\":{\"type\":\"integer\"},"
                + "\"title\":{\"type\":\"string\"},"
                + "\"description\":{\"type\":\"string\"},"
                + "\"startTime\":{\"type\":\"string\",\"format\":\"date-time\"},"
                + "\"endTime\":{\"type\":\"string\",\"format\":\"date-time\"},"
                + "\"maxSeats\":{\"type\":\"integer\"},"
                + "\"status\":{\"type\":\"string\"}"
                + "}"
                + "},"
                // Category Ticket
                + "\"CategoryTicket\":{"
                + "  \"type\":\"object\","
                + "  \"properties\":{"
                + "     \"categoryTicketId\":{\"type\":\"integer\"},"
                + "     \"name\":{\"type\":\"string\"},"
                + "     \"price\":{\"type\":\"number\",\"format\":\"double\"},"
                + "     \"maxQuantity\":{\"type\":\"integer\"},"
                + "     \"status\":{\"type\":\"string\"}"
                + "  }"
                + "},"
                //Seat List
                    + "\"Seat\":{"
                + "  \"type\":\"object\","
                + "  \"properties\":{"
                + "     \"seatId\":{\"type\":\"integer\"},"
                + "     \"areaId\":{\"type\":\"integer\"},"   // üîÅ
                + "     \"seatCode\":{\"type\":\"string\"},"
                + "     \"rowNo\":{\"type\":\"string\"},"
                + "     \"colNo\":{\"type\":\"string\"},"
                + "     \"status\":{\"type\":\"string\"},"
                + "     \"seatType\":{\"type\":\"string\"}"
                + "  }"
                + "},"
                     + "\"SeatResponse\":{"
                + "  \"type\":\"object\","
                + "  \"properties\":{"
                + "     \"areaId\":{\"type\":\"integer\"},"        // üîÅ
                + "     \"seatType\":{\"type\":\"string\"},"
                + "     \"total\":{\"type\":\"integer\"},"
                + "     \"seats\":{"
                + "        \"type\":\"array\","
                + "        \"items\":{\"$ref\":\"#/components/schemas/Seat\"}"
                + "     }"
                + "  }"
                + "},"
                // Event Detail 
                + "\"EventDetail\":{"
                + "  \"type\":\"object\","
                + "  \"properties\":{"
                + "     \"eventId\":{\"type\":\"integer\"},"
                + "     \"title\":{\"type\":\"string\"},"
                + "     \"description\":{\"type\":\"string\"},"
                + "     \"startTime\":{\"type\":\"string\",\"format\":\"date-time\"},"
                + "     \"endTime\":{\"type\":\"string\",\"format\":\"date-time\"},"
                + "     \"maxSeats\":{\"type\":\"integer\"},"
                + "     \"status\":{\"type\":\"string\"},"
                + "     \"venueName\":{\"type\":\"string\"},"
                + "     \"speakerName\":{\"type\":\"string\"},"
                + "     \"tickets\":{"
                + "        \"type\":\"array\","
                + "        \"items\":{\"$ref\":\"#/components/schemas/CategoryTicket\"}"
                + "     }"
                + "  }"
                + "},"
                + "}" // end schemas
                + "}" // end components
                + "}";  // end root

        try ( PrintWriter out = resp.getWriter()) {
            out.print(json);
            out.flush();
        }
    }
}
